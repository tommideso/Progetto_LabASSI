<%= search_form_for @q, url: search_path, method: :get do |f| %>
  <div class="relative">
    <input type="text" id="searchInput" class="block w-full px-4 py-2 border rounded-lg" placeholder="Cerca...">
    <button id="openModalButton" class="absolute inset-y-0 right-0 flex items-center px-4 py-2 text-white bg-blue-500 rounded-r-lg">üîç</button>
  </div>

  <!-- Modale -->
  <div id="searchModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-1/3">
      <button id="closeModalButton" class="text-gray-500 hover:text-gray-700">&times;</button>
      <h2 class="text-lg font-bold mb-4">Filtra la tua ricerca</h2>
      <form id="searchForm">
        <!-- Aggiungi qui i tuoi campi di input -->
        
        <div class="field">
          <%= f.label :titolo_cont, "Nome menu" %>
          <%= f.search_field :titolo_cont %>
        </div>

        <div class="field">
          <%= f.label :numero_persone, "Numero di persone" %>
          <%= text_field_tag :numero_persone, params[:numero_persone], placeholder: "Es. 5" %>
        </div>

        <div class="field">
          <%= f.label :search_date, "Data" %>
          <%= text_field_tag :search_date, params[:search_date], class: "form-control datepicker", data: { controller: "flatpickr", target: "datepicker.input" }, id: "search-date" %>
        </div>

        <div class="field">
          <h3>Filtra per allergeni:</h3>
          <% ["noci", "soia", "glutine", "arachidi", "lattosio", "crostacei"].each do |allergene| %>
            <label>
              <%= check_box_tag 'allergeni[]', allergene, params[:allergeni]&.include?(allergene) %>
              <%= allergene.capitalize %>
            </label>
          <% end %>
        </div>

        <div class="field">
          <h3>Filtra per preferenze alimentari:</h3>
          <% ["vegano", "glutine"].each do |preferenza| %>
            <label>
              <%= check_box_tag 'preferenze[]', preferenza, params[:preferenze]&.include?(preferenza) %>
              <%= preferenza.capitalize %>
            </label>
          <% end %>
        </div>

        <div class="actions">
          <%= f.submit "Search" %>
        </div>
      </form>
    </div>
  </div>
<%end%>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchModal = document.getElementById('searchModal');
    const closeModalButton = document.getElementById('closeModalButton');
    const openModalButton = document.getElementById('openModalButton');
    const searchForm = document.getElementById('searchForm'); // Assuming the form has an id of 'searchForm'

    openModalButton.addEventListener('click', (event) => {
      event.preventDefault(); // Prevent the form from being submitted
      searchModal.classList.remove('hidden');
    });

    closeModalButton.addEventListener('click', (event) => {
      event.preventDefault(); // Prevent the form from being submitted
      searchModal.classList.add('hidden');
    });

    // Chiudi il modale cliccando all'esterno di esso
    searchModal.addEventListener('click', (e) => {
      if (e.target === searchModal) {
        searchModal.classList.add('hidden');
      }
    });

    // Chiudi il modale alla sottomissione del form
    searchForm.addEventListener('submit', () => {
      searchModal.classList.add('hidden');
    });
  });
</script>