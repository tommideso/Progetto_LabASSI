<%= render partial: "shared_partials/mini_header" %>

<h1><%= @menu.titolo %></h1>
<!-- Immagini -->
<div>
  <% if @menu.images.attached? %>
      <% @menu.images.each do |image| %>
        <%= image_tag(image, height: '100') %>
        <br/>
      <% end %>
  <% end %>
</div>

<!-- Preferiti -->
<% if user_signed_in? && current_user.client? %>
  <%= link_to favorite_text, favorites_update_path(menu: @menu), remote: true, id:'favorite_link'  %>
<% end %>


<p><strong>Descrizione:</strong> <%= @menu.descrizione %></p>

<p><strong>Prezzo per Persona:</strong> <%= number_to_currency(@menu.prezzo_persona, unit: "€") %></p>

<p><strong>Numero Minimo di Persone:</strong> <%= @menu.min_persone %></p>

<p><strong>Numero Massimo di Persone:</strong> <%= @menu.max_persone %></p>

<p><strong>Tipo di Cucina:</strong> <%= @menu.tipo_cucina %></p>

<p><strong>Allergeni:</strong>
  <% if @menu.allergeni.present? %>
    <ul class="m-0">
      <% @menu.allergeni.each do |allergene, presente| %>
        <li><%= "#{allergene.capitalize}: #{presente == 'true' ? 'Sì' : 'No'}" %></li>
      <% end %>
    </ul>
  <% else %>
    <p>Nessun allergene registrato.</p>
  <% end %>
</p>

<p><strong>Preferenze Alimentari:</strong>
  <% if @menu.preferenze_alimentari.present? %>
    <ul>
      <% @menu.preferenze_alimentari.each do |preferenza, presente| %>
        <li><%= "#{preferenza.capitalize}: #{presente == 'true' ? 'Sì' : 'No'}" %></li>
      <% end %>
    </ul>
  <% else %>
    <p>Nessuna preferenza alimentare registrata.</p>
  <% end %>
</p>

<p><strong>Adattabile per allergeni:</strong>
  <% if @menu.adattabile.present? && @menu.adattabile["allergeni"].present? %>
    <ul>
      <% @menu.adattabile["allergeni"].each do |adattamento, presente| %>
        <li><%= "#{adattamento.capitalize}: #{presente == 'true' ? 'Sì' : 'No'}" %></li>
      <% end %>
    </ul>
  <% else %>
    <p> Nessun adattamento per allergeni.</p>
  <% end %>
</p>

<p><strong>Adattabile per preferenze alimentari:</strong>
  <% if @menu.adattabile.present? && @menu.adattabile["preferenze"].present? %>
    <ul>
      <% @menu.adattabile["preferenze"].each do |adattamento, presente| %>
        <li><%= "#{adattamento.capitalize}: #{presente == 'true' ? 'Sì' : 'No'}" %></li>
      <% end %>
    </ul>
  <% else %>
    <p>Nessun adattamento per preferenze alimentari.</p>
  <% end %>
</p>

<p><strong>Extra:</strong>
  <% if @menu.extra.present? %>
    <ul>
      <% @menu.extra.each do |extra, presente| %>
        <li><%= "#{extra.capitalize}: #{presente == 'true' ? 'Sì' : 'No'}" %></li>
      <% end %>
    </ul>
  <% else %>
    <p>Nessun extra registrato.</p>
  <% end %>
</p>

<p><strong>Prezzo Extra:</strong> <%= number_to_currency(@menu.prezzo_extra, unit: "€") %></p>

<p><strong>Disattivato:</strong> <%= @menu.disattivato ? 'Sì' : 'No' %></p>

<% if user_signed_in? && current_user.chef? %>
  <h3> <%= link_to "Modifica il post", edit_menu_path %> </h3>
<% end %>

<% if user_signed_in? && current_user.client? %>
  <%= form_with model: Reservation, url: reservations_path, local: true do |f| %>
    
    <%= f.hidden_field :client_id, value: current_user.client.id %>
    <%= f.hidden_field :prezzo_persona, value: @menu.prezzo_persona %>
    <%= f.hidden_field :extra, value: @menu.extra %>
    <%= f.hidden_field :menu_id, value: @menu.id %> 
    <%= f.hidden_field :chef_id, value: @menu.chef.id %>
    <%# Num Persone, TipoPasto, Data, Indirizzo di consegna %>
    <div class="form-group">
      <%= f.label :indirizzo_consegna %>
      <%= f.text_field :indirizzo_consegna, class: "form-control", value: current_user.client.indirizzo %>
    </div>
    <div class="form-group">
      <%= f.label :num_persone %>
      <%= f.number_field :num_persone, class: "form-control", min: @menu.min_persone, max: @menu.max_persone %>
    </div>
    <div class="form-group">
      <%= f.label :tipo_pasto %>
      <%# Prendo i valori del campo tipo_pasto dalla classe Reservation e li mappo in un array di coppie chiave-valore, dove la chiave è il valore del campo e il valore è il campo con la prima lettera maiuscola %>
      <%= f.select :tipo_pasto, Reservation.tipo_pastos.keys.map { |tipo_pasto| [tipo_pasto.humanize, tipo_pasto] }, class: "form-control" %>
    </div>
    <div class="form-group">
      <%= f.label :data_prenotazione %>
      <%= f.date_field :data_prenotazione, class: "form-control", min: Date.today, id: "data_prenotazione" %>
    </div>

    <%= f.submit "Prenota" %>
  <% end %>
<% end %>

