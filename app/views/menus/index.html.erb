
<h2 class="page-title">Menu</h2>

<div id="menu-list" class="grid grid-cols-4 gap-8 ">
   <% @menus.each do |menu| %>
      <%= render partial: "menu_card", locals: {menu: menu} %>
   <% end %>
</div>


<script>
   document.addEventListener("DOMContentLoaded", () => {
    const menuList = document.getElementById("menu-list");
    if (!menuList) return;
    let page = 1;
    const maxPages = <%= @total_pages %>;
      console.log(maxPages);

    const loadMore = () => {
         const test = document.getElementById("menu-list");
         if (!test) return;
         const scrollPosition = window.innerHeight + window.scrollY;
         const documentHeight = document.documentElement.scrollHeight;
         const scrollThreshold = documentHeight * 0.6; // 60% della pagina
         console.log(scrollPosition, documentHeight, scrollThreshold);
         if (scrollPosition >= scrollThreshold && page < maxPages) {
               page += 1;
               fetch(`/menus?page=${page}`, {
                  headers: { Accept: "text/vnd.turbo-stream.html" },
               })
                  .then((response) => response.text())
                  .then((html) => Turbo.renderStreamMessage(html))
                  .catch((error) => console.error("Error loading more menus:", error));
         }
    };

    const debounce = (func, wait) => {
        let timeout;
        return function(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    };

    window.addEventListener("scroll", debounce(loadMore, 200));
});
</script>